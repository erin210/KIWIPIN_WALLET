<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('layout/head') %>
</head>

<body class="walletLogin">
    <div id="apiWallet">
        <div class="container">
            <aside>
                <div class="logo">
                    <img src="<%- wallet %>/assets/img/logo3.svg" alt="">
                </div>
                <div class="tabs">
                    <div class="tab tab1">
                        <a href="login">
                            <i class="oo1"></i>
                            <i class="oo2"></i>
                            <h3><span class="WL_TAB_LOGIN">登入</span></h3>
                        </a>
                        <div class="bg_im"><img src="<%- wallet %>/assets/img/bg_im.svg" alt=""></div>
                    </div>
                    <div class="tab tab2 active">
                        <a href="register">
                            <i class="oo1"></i>
                            <i class="oo2"></i>
                            <h3><span class="WL_TAB_REGISTER">註冊</span></h3>
                        </a>
                        <div class="bg_im"><img src="<%- wallet %>/assets/img/bg_im.svg" alt=""></div>
                    </div>
                </div>
            </aside>

            <div class="tab_container">
                <div id="langSelect" class="languageBox">
                    <img src="<%- wallet %>/assets/img/icon_language.svg" alt="" srcset="">
                    <span class="lang_text">語言</span>
                    <ul id="langListItem" class="langListItem">
                        <ul id="landList">
                            <li class="active">
                                简中
                            </li>
                            <li>
                                English
                            </li>
                            <li>
                                日本語
                            </li>
                            <li>
                                한국어
                            </li>
                            <li>
                                Tiếng Việt
                            </li>
                        </ul>
                    </ul>
                </div>
                <div class="logo">
                    <img src="<%- wallet %>/assets/img/logo1.svg" alt="">
                </div>
                <!-- tab1 op-->
                <div id="tab1" class="tab_content">
                    <form role="form" id="form" action="" method="post" target="_self" class="form-payment"
                        onsubmit="return check_submit();">
                        <div class="form_list reg">
                            <h4 class="WL_TAB_REGISTER">註冊</h4>
                            <ul>
                                <li class="check_code email">
                                    <span class="WL_U_EMAIL_TITLE">會員信箱</span>
                                    <div id="send_code" class="send_code">
                                        <input type="text" name="U_EMAIL" id="U_EMAIL" class="WL_U_EMAIL_HINT" placeholder="請輸入Email">
                                        <a id="SEND_VERIFY_CODE" href="javascript:void(0)"
                                            onclick="return send_VERIFY_CODE();"><i class="WL_SEND_VERIFY_CODE_BTN">發送驗證碼</i><i class="WL_SEND_VERIFY_CODE_ING" style="display: none;">發送中...</i><i class="WL_SEND_VERIFY_CODE_RESEND" style="display: none;">重新發送</i></a>
                                        <div id="countdown" class="countdown send_code" style="display: none;"><a><img
                                                    src="<%- wallet %>/assets/img/icon_check_ok.svg" alt=""><i class="WL_SEND_VERIFY_CODE_COUNT">已發送</i>( <span
                                                    id="countdown_second">0</span>)</a></div>
                                    </div>
                                    <div class="wrong_msg email_msg" style="display:none"><img
                                            src="<%- wallet %>/assets/img/icon_error.svg" alt=""><small class="email_msg_text WL_U_EMAIL_MSG_EMPTY">空白警告</small><small class="email_msg_text WL_MSG_ERROR">格式錯誤警告</small></div>
                                </li>
                                <li class="check_code">
                                    <span class="WL_U_VERIFY_CODE_TITLE">驗證碼</span>
                                    <input type="text" name="U_VERIFY_CODE" id="U_VERIFY_CODE" class="WL_U_VERIFY_CODE_HINT" placeholder="請輸入驗證碼"
                                        inputmode="numeric">
                                    <div class="wrong_msg verify_code_msg" style="display:none"><img
                                            src="<%- wallet %>/assets/img/icon_error.svg" alt=""><small
                                            class="verify_code_msg_text WL_U_VERIFY_CODE_MSG_EMPTY">請填寫驗證碼</small></div>
                                </li>
                                <li class="check_code">
                                    <span class="WL_U_PASSWORD_TITLE">登入密碼</span>
                                    <div class="code_PW">
                                        <input class="input_visible WL_U_PASSWORD_HINT" type="password" name="U_PASSWORD" id="U_PASSWORD"
                                            placeholder="請輸入會員密碼">
                                        <img class="togglePassword" src="<%- wallet %>/assets/img/icon_eye_close.svg" alt="eye">

                                    </div>
                                    <div class="wrong_msg password_msg" style="display:none"><i class="icon"><img
                                                src="<%- wallet %>/assets/img/icon_error.svg"></i><small
                                            class="password_msg_text WL_U_PASSWORD_MSG_EMPTY">空白警告</small><small
                                            class="password_msg_text WL_U_PASSWORD_MSG_ERROR">格式錯誤警告</small>
                                    </div>
                                </li>
                                <li class="check_code">
                                    <span class="WL_U_PAY_PASSWORD_TITLE">交易密碼</span>
                                    <div class="code_PW">
                                        <input class="input_visible WL_U_PAY_PASSWORD_HINT" type="password" name="U_PAY_PASSWORD"
                                            inputmode="numeric" id="U_PAY_PASSWORD" placeholder="請輸入錢包交易密碼" maxlength="6">
                                        <img class="togglePassword" src="<%- wallet %>/assets/img/icon_eye_close.svg" alt="eye">
                                    </div>
                                    <div class="wrong_msg password_msg" style="display:none"><i class="icon"><img
                                                src="<%- wallet %>/assets/img/icon_error.svg"></i><small
                                            class="pay_password_msg_text WL_U_PAY_PASSWORD_MSG_EMPTY">空白警告</small><small class="pay_password_msg_text WL_U_PAY_PASSWORD_MSG_ERROR">格式錯誤警告</small>
                                    </div>
                                </li>
                                <li class="check_code">
                                    <span class="WL_U_PAY_PASSWORD_CHECK_TITLE">確認交易密碼</span>
                                    <div class="code_PW">
                                        <input class="input_visible_check WL_U_PAY_PASSWORD_CHECK_HINT" type="password" name="U_PAY_PASSWORD_CHECK"
                                            inputmode="numeric" id="U_PAY_PASSWORD_CHECK" placeholder="請再次輸入錢包交易密碼">
                                        <img class="togglePassword" src="<%- wallet %>/assets/img/icon_eye_close.svg" alt="eye">
                                    </div>
                                    <div class="wrong_msg new_password_check_msg" style="display:none">
                                        <i class="icon"><img src="<%- wallet %>/assets/img/icon_error.svg"></i><small
                                            class="pay_password_check_msg_text WL_U_PAY_PASSWORD_CHECK_MSG_EMPTY">空白警告</small>
                                            <small class="pay_password_check_msg_text WL_U_PAY_PASSWORD_CHECK_MSG_ERROR">格式錯誤警告</small>
                                    </div>
                                </li>
                            </ul>
                            <!--<a href="member_forget_pw.html" class="btn btn_blue">上一步</a>-->
                            <div class="form_bt">
                                <!-- <div class="terms">
                                        <input id="agree" type="checkbox" id="terms">
                                        <label for="terms">閱讀並同意 
                                            <a href="https://www.kiwipin.com/terms_of_service">會員服務條款</a>、
                                            <a href="https://www.kiwipin.com/privacy_policy">隱私權政策</a>
                                        </label>
                                        <div class="wrong_msg agree_msg" style="display:none"><img src="<%- wallet %>/assets/img/icon_error.svg" alt=""><span class="agree_msg_text">請勾選同意</span></div>
                                    </div> -->
                                <p class="formbt_link">已有帳號？ <a href="login" class="tab_bt"
                                        rel="tab1">返回登入</a></p>

                                <div class="terms custom-checkbox">
                                    <input id="agree" type="checkbox">
                                    <label for="agree"><b class="WL_AGREE_LABEL">閱讀並同意</b>
                                        <a class="WL_AGREE_LABEL_LINK1" href="<%- cdn %>/terms_of_service" target="_blank">會員服務條款</a>、
                                        <a class="WL_AGREE_LABEL_LINK2" href="<%- cdn %>/privacy_policy" target="_blank">隱私權政策</a>
                                    </label>
                                    <div class="wrong_msg agree_msg" style="display:none"><img
                                            src="<%- wallet %>/assets/img/icon_error.svg" alt=""><small
                                            class="agree_msg_text WL_AGREE_HINT">請勾選同意</small></div>
                                </div>
                                <a id="confirm" href="javascript:void(0)" onclick="return check_submit();"
                                    class="btn btn_blue WL_TAB_REGISTER">註冊</a>
                            </div>
                        </div>
                        <input id="U_LANGUAGE" type="hidden" name="U_LANGUAGE" value="">
                    </form>
                </div>
                <!-- tab1 ed-->
            </div>
        </div>
    </div>
    <!--popup_1-->
    <div id="popup" class="popup" style="display: none;">
        <div class="container">
            <div class="popup_left"></div>
            <div class="popup_wrapper">
                <div class="content">
                    <img class="icon popup_icon popup_icon_success" src="<%- wallet %>/assets/img/icon_success.svg" alt="">
                    <img class="icon popup_icon popup_icon_error" src="<%- wallet %>/assets/img/icon_error.svg" alt="">
                    <h1 id="popup_title" class="title">跳窗標題</h1>
                    <h1 id="popup_notice" class="notice">跳窗資訊內文</h1>
                </div>
                <a id="popup_a" href="javascript:void(0)" onclick="$('#popup').hide();"
                    class="btn confirm btn_pop_close WL_CONFIRM">確認</a>
            </div>
        </div>
    </div>

    <script>
        // $(function () {
        //     $('base').attr('href', apiUrl);
        // });
            $("#U_LANGUAGE").val(thisLang);
        

        function renderInfo(json) {
            
            //if成功-沒有跳窗，直接跳到:wallet/home

            //popup-註冊有問題！ 
            if (json.SYSTEM_MESSAGE !== null && json.SYSTEM_MESSAGE !== undefined) {
                
                //解構parseSystemMessage
                const { id: RESULT_ID, msg: RESULT_MSG } = parseSystemMessage(json.SYSTEM_MESSAGE) || {};

                const systemMSG = parseSystemMessage(json.SYSTEM_MESSAGE);
                $(".popup_icon").hide();
                $(".popup_icon_error").show();
                $("#popup_title").attr('class', 'title WL_VERIFY_TITLE_F');
                $("#popup_notice").html(`<b class="${RESULT_ID}"></b>${RESULT_MSG}`);
                $("#popup").show();
            }
            
            

            Object.keys(json).forEach(function (k) {
                var eleName = '#' + k;
                //console.log(eleName + ' - ' + json[k]);
                if ($(eleName).length <= 0) {
                    appendElement_Input('#form', k, json[k]);
                } else {
                    $(eleName).val(json[k]);
                }
            });
            
            initTranslation(json)//翻譯

        }
        //整理 SYSTEM_MESSAGE-ID+系統字
            function parseSystemMessage(systemMessage) {
                if (!systemMessage) return null;

                // 解析 [%ID%] 後面的字串
                const matchId = systemMessage.match(/\[%(.+?)%\](.*)/);

                if (!matchId) return null;

                const RESULT_ID = matchId[1];
                const RESULT_MSG = (matchId[2] || "").trim();

                return { id: RESULT_ID, msg: RESULT_MSG };
            }

        function appendElement_Input(ele, name, value) {
            var textHtml = '<input type="hidden" name="' + name + '"';
            textHtml += ' value="' + value + '"';
            textHtml += '/>';
            $(ele).append(textHtml);
        }

        //密碼眼睛
        let pageBaseUrl = '';
        $('.togglePassword').on('click', function () {
            const passwordField = $(this).siblings('input');
            const isPasswordVisible = passwordField.attr('type') === 'text';
            passwordField.attr('type', isPasswordVisible ? 'password' : 'text');

            const newIconSrc = isPasswordVisible ? pageBaseUrl + '<%- wallet %>/assets/img/icon_eye_close.svg' : pageBaseUrl + '<%- wallet %>/assets/img/icon_eye_open.svg';
            $(this).attr('src', newIconSrc);
        });

        function preventScroll(e) {
            e.preventDefault(); // 禁止滾動
        }
        
        //發送驗證碼
        function send_VERIFY_CODE() {
            // 檢查是否有填寫 #U_EMAIL
            if (!validateEmptyField('#U_EMAIL', '.email_msg_text', ".WL_U_EMAIL_MSG_EMPTY")) {
                return;
            }

            // 檢查格式是否正確
            if (!validateEmailFormat('#U_EMAIL', '.email_msg_text', '.WL_MSG_ERROR')) {
                return;
            }

            const TOKEN = "";
            
            // console.log();
            
           
            const url = "<%- wallet_cdn %>/sendVerifyCode";
            // const url = "http://localhost:3001/sendVerifyCode";//本地測試用

            let headers = {
                "Content-Type": "application/json",
                "Accept": "application/json"
            };

            // 如果有需要帶 Token
            if (TOKEN) {
                headers["Authorization"] = `Bearer ${TOKEN}`;
            }

            // console.log($('#SEND_VERIFY_CODE').data('lang'));
            
            // API 文件規定的必填參數
            let body = {
                "TYPE": "REGISTER",
                "VERIFY_TYPE": "REGISTER",
                "EMail": $('#U_EMAIL').val(),
                "LANGUAGE": $("#U_LANGUAGE").val()
            };
            //鎖住畫面
            $.LoadingOverlay("show", {
                image: "",  // 不用預設圖片
                custom: $("<div>", { class: "custom-spinner" })[0],
                background: "rgba(255,255,255,0.8)"
            });

            fetch(url, {
                method: "POST",
                headers: headers,
                body: JSON.stringify(body) // 一定要轉字串
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error("HTTP Error " + response.status);
                }
                return response.json();
            })
            .then(function (json) {
                // console.log(json);

                // console.log(json.StringID.en_US.VERIFY_TITLE_S);

                // console.log("收到 JSON:", json);
                $(".popup_icon").hide();

                if (json.SendResult === "Success") {
                    $(".popup_icon_success").show();
                    $("#popup_title").text(json.SendResult_Title);
                    $("#popup_notice").text(json.SendResult_Message);

                    $('#U_EMAIL').attr('readonly', true);
                } else {
                    $(".popup_icon_error").show();
                    $("#popup_title").text(json.SendResult_Title);
                    $("#popup_notice").text(json.SendResult_Message);
                }

                $.LoadingOverlay("hide");
                $("#popup").show();

                // 控制按鈕與倒數
                $('#SEND_VERIFY_CODE').attr('disabled', true).hide();
                $("#countdown").show();
                $('.WL_SEND_VERIFY_CODE_BTN').hide();
                $('.WL_SEND_VERIFY_CODE_ING').fadeIn(100);

                timer_countdown(60, "countdown_second", "timer_Finished");

            })
            .catch(err => {

                console.error("API 錯誤:", err);
                $(".popup_icon").hide();
                $(".popup_icon_error").show();
                $("#popup_title")
                    .attr("class", "")
                    .addClass("title WL_VERIFY_TITLE_F");
                $("#popup_notice").html("系統發生錯誤，請稍後再試。");
                
                $.LoadingOverlay("hide");
                $("#popup").show();
            });



        $('#U_VERIFY_CODE').attr('disabled', false);
    }

        // function handleApiResponse(json) {
        //     $(".popup_icon").hide();
        //     if (json.SendResult === "Success") {
        //         $(".popup_icon_success").show();
        //         $("#popup_title").text("驗證碼發送成功");
        //         // $("#popup_notice").text("驗證碼已發送到："+$('#U_EMAIL').val());
        //         $('#U_EMAIL').attr('disabled', true);
        //     } else {
        //         $(".popup_icon_error").show();
        //         $("#popup_title").text("發生錯誤了!");
        //     }
        //     $('#popup_notice').text(json.SendResult_Message);
        //     $("#popup").show();
        //     $('#SEND_VERIFY_CODE').removeAttr('disabled');
        //     $("#SEND_VERIFY_CODE").hide();
        //     $("#countdown").show();
        // }

        // 監聽驗證 op====================
        // 驗證函數 - 是否空白
        function validateEmptyField(selector, messageSelector, messageClass) {
            const value = $(selector).val();
            if (value === "") {
                $(messageSelector).hide();
                $(messageSelector + messageClass).show().parent().show(); // 顯示父層 .password_msg
                $(selector).addClass('input_error');
                return false;
            } else {
                $(messageSelector).parent().hide();
                $(selector).removeClass('input_error');
                return true;
            }
        }
        // 驗證函數 - 是否符合格式 (Email)
        function validateEmailFormat(selector, messageSelector, messageClass) {
            const value = $(selector).val();
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // Email 正則表達式
            if (!emailPattern.test(value)) {
                $(messageSelector).hide();
                $(messageSelector+messageClass).show().parent().show();
                $(selector).addClass('input_error');
                return false;
            } else {
                $(messageSelector).parent().hide();
                $(selector).removeClass('input_error');
                return true;
            }
        }

        // 驗證函數 - 是否符合格式(Password)
        function validatePasswordFormat(selector, messageSelector, messageClass) {
            const value = $(selector).val();
            // 密碼須為英數混合8字元以上，可接受的特殊字元~!@#$%^&*()_-+
            const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d~`!@#$%^&*()_\-+]{8,}$/;
            if (!passwordPattern.test(value)) {
                $(messageSelector).hide();
                $(messageSelector+messageClass).show().parent().show();
                $(selector).addClass('input_error');
                return false;
            } else {
                $(messageSelector).parent().hide();
                $(selector).removeClass('input_error');
                return true;
            }
        }

        // 驗證函數 - 是否符合格式(Number)
        function validateNumberFormat(selector, messageSelector, messageClass) {
            const value = $(selector).val();
            const sixDigitPattern = /^\d{6}$/;
            if (!sixDigitPattern.test(value)) {
                $(messageSelector).hide();
                $(messageSelector + messageClass).show().parent().show();
                $(selector).addClass('input_error');
                return false;
            } else {
                $(messageSelector).parent().hide();
                $(selector).removeClass('input_error');
                return true;
            }
        }

        // 驗證函數 - “密碼”是否跟”密碼確認“相同
        function validatePasswordMatch(selector1, selector2, messageSelector, messageClass) {
            const value1 = $(selector1).val();
            const value2 = $(selector2).val();
            if (value1 !== value2) {
                $(messageSelector).hide();
                $(messageSelector + messageClass).show().parent().show();
                $(selector2).addClass('input_error');
                return false;
            } else {
                $(messageSelector).parent().hide();
                $(selector2).removeClass('input_error');
                return true;
            }
        }

        // 驗證函數 - checkbox是否打勾
        function validateCheckbox(selector, messageSelector, messageClass) {
            const value = $(selector);
            if (!value.is(':checked')) {
                $(messageSelector).hide();
                $(messageSelector + messageClass).show().parent().show();
                $(selector).addClass('input_error');
                return false;
            } else {
                $(messageSelector).parent().hide();
                $(selector).removeClass('input_error');
                return true;
            }
        }


        // 即時監聽驗證
        // 會員帳號
        $('#U_EMAIL').on('input', function () {
            if (validateEmptyField('#U_EMAIL', '.email_msg_text', ".WL_U_EMAIL_MSG_EMPTY"))
                validateEmailFormat('#U_EMAIL', '.email_msg_text','.WL_MSG_ERROR');
        });
        // 驗證碼有輸入
        $('#U_VERIFY_CODE').on('input', function () {
            if ($(this).val() !== "") {
                $('.verify_code_msg_text').parent().hide(); // 隱藏錯誤訊息
                $(this).removeClass('input_error'); // 移除錯誤樣式
            }
        });

        // 登入密碼
        $('#U_PASSWORD').on('input', function () {
            // 登入密碼的格式驗證
            if (validateEmptyField('#U_PASSWORD', '.password_msg_text', ".WL_U_PASSWORD_MSG_EMPTY")) {
                validatePasswordFormat('#U_PASSWORD', '.password_msg_text','.WL_U_PASSWORD_MSG_ERROR');
            }
        });
        // 交易密碼
        $('#U_PAY_PASSWORD').on('input', function () {
            // 登入密碼的格式驗證
            if (validateEmptyField('#U_PAY_PASSWORD', '.pay_password_msg_text', ".WL_U_PAY_PASSWORD_MSG_EMPTY")) {
                validateNumberFormat('#U_PAY_PASSWORD', '.pay_password_msg_text','.WL_U_PAY_PASSWORD_MSG_ERROR');
            }
        });

        // 確認交易密碼
        $('#U_PAY_PASSWORD_CHECK').on('input', function () {
            if (validateEmptyField('#U_PAY_PASSWORD_CHECK', '.pay_password_check_msg_text', ".WL_U_PAY_PASSWORD_CHECK_MSG_EMPTY")) {
                validatePasswordMatch('#U_PAY_PASSWORD', '#U_PAY_PASSWORD_CHECK', '.pay_password_check_msg_text','.WL_U_PAY_PASSWORD_CHECK_MSG_ERROR');
            }
        });

        // 確認是否勾選
        $('#agree').on('change', function () {
            if (validateCheckbox('#agree', '.agree_msg_text', '.WL_AGREE_HINT')) {
            }
        });

        // 監聽驗證 ed====================

        // 提交的驗證
        function check_ALL() {
            let isValid = true;
            //email
            if (!validateEmptyField('#U_EMAIL', '.email_msg_text', ".WL_U_EMAIL_MSG_EMPTY")) isValid = false;
            if (isValid && !validateEmailFormat('#U_EMAIL', '.email_msg_text', '.WL_MSG_ERROR')) isValid = false;
            //帳戶密碼
            if (!validateEmptyField('#U_PASSWORD', '.password_msg_text', ".WL_U_PASSWORD_MSG_EMPTY")) isValid = false;
            if (isValid && !validatePasswordFormat('#U_PASSWORD', '.password_msg_text', '.WL_U_PASSWORD_MSG_ERROR')) isValid = false;
            //交易密碼
            if (!validateEmptyField('#U_PAY_PASSWORD', '.pay_password_msg_text', ".WL_U_PAY_PASSWORD_MSG_EMPTY")) isValid = false;
            if (isValid && !validateNumberFormat('#U_PAY_PASSWORD', '.pay_password_msg_text', '.WL_U_PAY_PASSWORD_MSG_ERROR')) isValid = false;

            //確認交易密碼
            if (!validateEmptyField('#U_PAY_PASSWORD_CHECK', '.pay_password_check_msg_text', ".WL_U_PAY_PASSWORD_CHECK_MSG_EMPTY")) isValid = false;
            if (isValid && !validatePasswordMatch('#U_PAY_PASSWORD', '#U_PAY_PASSWORD_CHECK', '.pay_password_check_msg_text', '.WL_U_PAY_PASSWORD_CHECK_MSG_ERROR')) isValid = false;

            //驗證碼
            if (!validateEmptyField('#U_VERIFY_CODE', '.verify_code_msg_text', ".WL_U_VERIFY_CODE_MSG_EMPTY")) isValid = false;
            //同意條款
            if (!validateCheckbox('#agree', '.agree_msg_text', ".WL_AGREE_HINT")) isValid = false;

            return isValid;
        }

        //   function check_U_VERIFY_CODE(){
        //     if($('#U_VERIFY_CODE').val() == ""){
        //       $('.verify_code_msg_text').text("請填寫驗證碼");
        //       $('.verify_code_msg').show();
        //       $('#U_VERIFY_CODE').focus();
        //       return false;
        //     }
        //     return true;
        //   }
        //   function check_agree(){
        //     if(!$('#agree').is(':checked') ){
        //       $('.agree_msg_text').text("請勾選同意");
        //       $('.agree_msg').show();
        //       $('#agree').focus();
        //       return false;
        //     }
        //     return true;
        //   }

        function check_submit() {

            if (!check_ALL()) {
                return false;
            }

            // if(!check_U_VERIFY_CODE()){
            //     return false;
            // }

            // if(!check_agree()){
            //     return false;
            // }
            //鎖住畫面
            $.LoadingOverlay("show", {
                image: "",  // 不用預設圖片
                custom: $("<div>", { class: "custom-spinner" })[0],
                background: "rgba(255,255,255,0.8)"
            });

            document.getElementById('form').submit();
            //return true;
        }


        function timer_countdown(countdownTime, eleID, callFunction) {
            let temp_eleID = "#" + eleID;

            // 更新顯示的倒數秒數
            if (eleID && $(temp_eleID).length) {
                $(temp_eleID).text(countdownTime + "s");
            }

            countdownTime--;  // 倒數計時減少 1 秒

            // 檢查是否還有剩餘時間
            if (countdownTime >= 0) {
                setTimeout(function () {
                    timer_countdown(countdownTime, eleID, callFunction);
                }, 1000);  // 每秒更新一次
            } else {
                // 倒數結束時執行指定的回呼函數
                if (callFunction !== undefined) {
                    let functionName = callFunction.split('(')[0];
                    let params = null;

                    // 檢查是否有參數傳入
                    if (callFunction.split('(')[1] !== undefined) {
                        params = callFunction.split('(')[1].split(')')[0];
                        params = params.replace(/^'|'$/g, '').replace(/^\"|\"$/g, '');
                        console.log(params);
                    }

                    // 執行回呼函數
                    window[functionName](params);
                }
            }
        }


        function timer_Finished() {
            $("#countdown").hide();
            $("#SEND_VERIFY_CODE").show();
            $('.WL_SEND_VERIFY_CODE_ING').hide();
            $('.WL_SEND_VERIFY_CODE_RESEND').fadeIn(100);
            $('#U_EMAIL').attr('disabled', false);
        }
    </script>

    <script>
        initFunction({ "Tpye": "REGISTER", 
        //  "U_VERIFY_CODE": "151997", "U_PASSWORD": "qwe123456", "U_PASSWORD_CHECK": "qwe123456", "U_PAY_PASSWORD": "123123", "U_PAY_PASSWORD_CHECK": "123123","U_EMAIL": "amy@gmail.com", 
        
        // "MESSAGE_TYPE": "F", "ErrorMessage": "WL_SUBMIT_INFO_F", "SYSTEM_MESSAGE": "[%WL_SUBMIT_INFO_F%]",
         "LanguageList": { "en_US": "English", "zh_TW": "\u4e2d\u6587" }, "StringID": { "en_US": { "WL_AGREE_HINT": "Please agree", "WL_AGREE_LABEL": "I agree to", "WL_AGREE_LABEL_LINK1": "Terms of Service", "WL_AGREE_LABEL_LINK2": "Privacy Policy", "WL_MSG_ERROR": "Enter a valid Email", "WL_REG_SUBMIT_INFO_S": "Registered successfully. Please log in.", "WL_REG_SUBMIT_TITLE_S": "Sign Up Success!", "WL_REG_VERIFY_INFO_F": "Email already in use!", "WL_SEND_VERIFY_CODE_BTN": "Send Code", "WL_SEND_VERIFY_CODE_COUNT": "Sent", "WL_SEND_VERIFY_CODE_ING": "Sending...", "WL_SEND_VERIFY_CODE_RESEND": "Resend", "WL_SUBMIT_INFO_F": "Invalid or expired code!", "WL_SUBMIT_TITLE_F": "Error", "WL_TAB_LOGIN": "Login", "WL_TAB_REGISTER": "Sign Up", "WL_U_EMAIL_HINT": "Enter Email", "WL_U_EMAIL_MSG_EMPTY": "Email required", "WL_U_EMAIL_TITLE": "Email", "WL_U_PASSWORD_HINT": "Enter Password", "WL_U_PASSWORD_MSG_EMPTY": "Password required", "WL_U_PASSWORD_MSG_ERROR": "Password must be 8+ chars, letters & numbers", "WL_U_PAY_PASSWORD_CHECK_HINT": "Re-enter Wallet PIN", "WL_U_PAY_PASSWORD_CHECK_MSG_EMPTY": "Confirm PIN required", "WL_U_PAY_PASSWORD_CHECK_MSG_ERROR": "PINs do not match", "WL_U_PAY_PASSWORD_CHECK_TITLE": "Confirm PIN", "WL_U_PAY_PASSWORD_HINT": "Enter Wallet PIN", "WL_U_PAY_PASSWORD_MSG_EMPTY": "PIN required", "WL_U_PAY_PASSWORD_MSG_ERROR": "Enter 6 digits", "WL_U_PAY_PASSWORD_TITLE": "Pay PIN", "WL_U_VERIFY_CODE_HINT": "Enter Code", "WL_U_VERIFY_CODE_MSG_EMPTY": "Code required", "WL_U_VERIFY_CODE_TITLE": "Verification Code", "WL_VERIFY_INFO_F": "Failed:", "WL_VERIFY_INFO_S": "Code sent to:", "WL_VERIFY_TITLE_F": "Error!", "WL_VERIFY_TITLE_S": "Code Sent" }, "zh_TW": { "WL_AGREE_HINT": "\u8acb\u52fe\u9078\u540c\u610f", "WL_AGREE_LABEL": "\u95b1\u8b80\u4e26\u540c\u610f", "WL_AGREE_LABEL_LINK1": "\u6703\u54e1\u670d\u52d9\u689d\u6b3e", "WL_AGREE_LABEL_LINK2": "\u96b1\u79c1\u6b0a\u653f\u7b56", "WL_MSG_ERROR": "\u8acb\u8f38\u5165\u6709\u6548\u7684 Email \u683c\u5f0f", "WL_REG_SUBMIT_INFO_S": "\u8a3b\u518a\u6210\u529f\uff0c\u8acb\u91cd\u65b0\u767b\u5165", "WL_REG_SUBMIT_TITLE_S": "\u8a3b\u518a\u6210\u529f\uff01", "WL_REG_VERIFY_INFO_F": "\u6b64 EMail \u5df2\u7d93\u4f7f\u7528!", "WL_SEND_VERIFY_CODE_BTN": "\u767c\u9001\u9a57\u8b49\u78bc", "WL_SEND_VERIFY_CODE_COUNT": "\u5df2\u767c\u9001", "WL_SEND_VERIFY_CODE_ING": "\u767c\u9001\u4e2d...", "WL_SEND_VERIFY_CODE_RESEND": "\u91cd\u65b0\u767c\u9001", "WL_SUBMIT_INFO_F": "\u9a57\u8b49\u78bc\u932f\u8aa4\u6216\u5df2\u5931\u6548!", "WL_SUBMIT_TITLE_F": "\u767c\u751f\u932f\u8aa4\u4e86", "WL_TAB_LOGIN": "\u767b\u5165", "WL_TAB_REGISTER": "\u8a3b\u518a", "WL_U_EMAIL_HINT": "\u8acb\u8f38\u5165Email", "WL_U_EMAIL_MSG_EMPTY": "\u8acb\u586b\u5bebEmail", "WL_U_EMAIL_TITLE": "\u6703\u54e1\u4fe1\u7bb1", "WL_U_PASSWORD_HINT": "\u8acb\u8f38\u5165\u6703\u54e1\u5bc6\u78bc", "WL_U_PASSWORD_MSG_EMPTY": "\u8acb\u586b\u5beb\u767b\u5165\u5bc6\u78bc", "WL_U_PASSWORD_MSG_ERROR": "\u5bc6\u78bc\u9808\u70ba\u82f1\u6578\u6df7\u54088\u5b57\u5143\u4ee5\u4e0a", "WL_U_PAY_PASSWORD_CHECK_HINT":   "\u8acb\u518d\u6b21\u8f38\u5165\u9322\u5305\u4ea4\u6613\u5bc6\u78bc", "WL_U_PAY_PASSWORD_CHECK_MSG_EMPTY": "\u8acb\u518d\u6b21\u586b\u5beb\u4ea4\u6613\u5bc6\u78bc", "WL_U_PAY_PASSWORD_CHECK_MSG_ERROR": "\u4e8c\u6b21\u8f38\u5165\u65b0\u5bc6\u78bc\u4e0d\u4e00\u81f4", "WL_U_PAY_PASSWORD_CHECK_TITLE": "\u78ba\u8a8d\u4ea4\u6613\u5bc6\u78bc", "WL_U_PAY_PASSWORD_HINT": "\u8acb\u8f38\u5165\u9322\u5305\u4ea4\u6613\u5bc6\u78bc", "WL_U_PAY_PASSWORD_MSG_EMPTY": "\u8acb\u586b\u5beb\u4ea4\u6613\u5bc6\u78bc", "WL_U_PAY_PASSWORD_MSG_ERROR": "\u8acb\u8f38\u5165\u516d\u4f4d\u6578\u5b57", "WL_U_PAY_PASSWORD_TITLE": "\u4ea4\u6613\u5bc6\u78bc", "WL_U_VERIFY_CODE_HINT": "\u8acb\u8f38\u5165\u9a57\u8b49\u78bc", "WL_U_VERIFY_CODE_MSG_EMPTY": "\u8acb\u586b\u5beb\u9a57\u8b49\u78bc", "WL_U_VERIFY_CODE_TITLE": "\u9a57\u8b49\u78bc", "WL_VERIFY_INFO_F": "\u9a57\u8b49\u78bc\u767c\u9001\u5931\u6557:", "WL_VERIFY_INFO_S": "\u9a57\u8b49\u78bc\u5df2\u767c\u9001\u5230\uff1a", "WL_VERIFY_TITLE_F": "\u767c\u751f\u932f\u8aa4\u4e86!", "WL_VERIFY_TITLE_S": "\u9a57\u8b49\u78bc\u767c\u9001\u6210\u529f" } }});
    </script>
</body>

</html>